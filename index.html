<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goose Hunt</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #3b3a3e; 
            font-family: 'Inter', sans-serif;
            color: #fff;
            flex-direction: column;
            overflow: hidden; /* Prevent scrollbars */
        }
        #info {
            margin-bottom: 10px;
            text-align: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            max-width: 90%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);

        }
        canvas {
            border: 2px solid #6b6a6f;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
           
            position:relative;
            top:-30px;
            /* Custom crosshair cursor using SVG data URI */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="12" fill="none" stroke="white" stroke-width="2"/><line x1="15" y1="3" x2="15" y2="27" stroke="white" stroke-width="2"/><line x1="3" y1="15" x2="27" y2="15" stroke="white" stroke-width="2"/></svg>') 15 15, crosshair; 
        }
        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #4CAF50; /* Green */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px #388E3C;
            transition: background-color 0.3s, box-shadow 0.3s;
            display: none; /* Hidden by default */
        }
        #restartButton:hover {
            background-color: #45a049;
            box-shadow: 0 2px #388E3C;
        }
        /* Custom text style for score/timer within Phaser canvas */
        .score-text-style {
            font-size: 24px;
            font-weight: bold;
            fill: #ffffff;
            stroke: #000000;
            stroke-thickness: 4;
        }
        /* Style for the goose emoji */
        .goose-emoji-style {
            font-size: 48px; /* Making the target large enough */
            fill: #000000;
        }
    </style>
</head>
<body>

    <div id="info">
        <p><strong>Goose Hunt</strong></p>
        <p>Your mission: shoot as many geese as you can in 30 seconds! Click or tap on a goose to shoot it.</p>
    </div>

    <div id="goose-game"></div>

    <button id="restartButton">Play Again</button>
    <audio id="gunshotaudio" src="gunshot.mp3"></audio>

    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'goose-game',
            physics: {
                default: 'arcade',
                arcade: {
                    debug: false // Set to true for visible physics bodies
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        let geese;
        let score = 0;
        let scoreText;
        let timerText;
        let gameOverText;
        let gameTimer;
        let gameOver = false;
        let restartButton; 
        let quackaudio;
        let shootaudio;

        const GOOSE_TEXT = 'ðŸ¦†'; // Goose emoji
        const SPLAT_TEXT = 'ðŸ’¥'; // Splat effect emoji
        const GAME_DURATION = 30000; // 30 seconds in milliseconds

        function preload ()
        {
            // loads the  background
            this.load.image('sky', 'https://labs.phaser.io/assets/skies/space3.png');
        }

        function create ()
        {
            
            gunshotaudio = document.getElementById('gunshotaudio');
            // Reset game state
            score = 0;
            gameOver = false;

            // Add background
            this.add.image(400, 300, 'sky').setScale(1.5); 

            // Create a group for geese (using text objects with physics)
            geese = this.physics.add.group({
                // Ensure text objects are added to physics group with correct size
                classType: Phaser.GameObjects.Text,
                runChildUpdate: true
            });

            // Setup score text
            scoreText = this.add.text(16, 16, 'Score: 0', { 
                fontSize: '24px', fill: '#ffffff', stroke: '#000000', strokeThickness: 4 
            });
            timerText = this.add.text(config.width - 16, 16, 'Time: 30', { 
                fontSize: '24px', fill: '#ffffff', stroke: '#000000', strokeThickness: 4 
            }).setOrigin(1, 0);

            // Add input listener for clicking/tapping geese. 
            // .bind(this) ensures the function is called correctly within the Scene context.
            this.input.on('gameobjectdown', onGooseHit.bind(this));

            // Spawn geese periodically
            this.time.addEvent({
                delay: 700, 
                callback: spawnGoose,
                callbackScope: this,
                loop: true
            });

            // Game timer
            gameTimer = this.time.addEvent({
                delay: GAME_DURATION,
                callback: endGame,
                callbackScope: this,
                loop: false
            });

            // Handle the restart button visibility and click
            restartButton = document.getElementById('restartButton');
            restartButton.style.display = 'none';
            restartButton.onclick = () => {
                // Remove the button from the display before restarting the scene
                restartButton.style.display = 'none';
                this.scene.restart();
            };
          
        }

        function update (time, delta)
        {
            if (gameOver) return;

            // Update timer display
            const remainingTime = Math.max(0, Math.ceil((GAME_DURATION - gameTimer.getElapsed()) / 1000));
            timerText.setText('Time: ' + remainingTime);

            // Loop through all active geese
            geese.children.each(function(goose) {
                // Remove geese that fly off-screen
                if (goose.x < -100 || goose.x > config.width + 100) {
                    goose.destroy();
                }
            }, this);
        }

        function spawnGoose() {
            if (gameOver) return;

            const side = Phaser.Math.Between(0, 1); // 0 for left, 1 for right
            const x = (side === 0) ? -50 : config.width + 50;
            const y = Phaser.Math.Between(100, config.height - 100);
            const speed = Phaser.Math.Between(150, 300); // Random horizontal speed
            const verticalThrust = Phaser.Math.Between(-20, 20); // Slight vertical movement

            // Create a Phaser Text object for the goose emoji
            const goose = geese.create(x, y, GOOSE_TEXT, { fontSize: '48px' });
            
            // Text objects need physics body explicitly added
            goose.setInteractive(); 
            goose.setOrigin(0.5);

            // Set velocity on the physics body
            goose.body.setVelocityX((side === 0) ? speed : -speed);
            goose.body.setVelocityY(verticalThrust); 
            goose.body.setAllowGravity(false); // Make them fly straight

            // Flip sprite if coming from right (Phaser text objects don't flip easily, 
            // but we can adjust the angle slightly for visual variation)
            if (side === 1) {
                goose.setAngle(10);
            } else {
                goose.setAngle(-10);
            }
        }

        function onGooseHit(pointer, gameObject) {
            if (gameOver) return;

            // Check if the game object is a goose (based on its text content)
            if (gameObject.text === GOOSE_TEXT) {
                score += 1;
                scoreText.setText('Score: ' + score);

                // Create a splat effect (temporary emoji text)
                const splat = this.add.text(gameObject.x, gameObject.y, SPLAT_TEXT, { fontSize: '64px' }).setOrigin(0.5);
                
                this.tweens.add({
                    targets: splat,
                    alpha: 0, // Fade out
                    duration: 500,
                    scale: 1.5, // Grow slightly
                    onComplete: function() {
                        splat.destroy();
                    }
                });

                gameObject.destroy(); // Remove the goose
                gunshotaudio.currentTime = 0;
                gunshotaudio.play();
      
            }
        }

        function endGame() {
            gameOver = true;
            this.physics.pause(); // movement
            this.time.removeAllEvents(); // Stop spawning geese

            gameOverText = this.add.text(config.width / 2, config.height / 2, 'GAME OVER!', { fontSize: '48px', fill: '#ff0000', stroke: '#000000', strokeThickness: 8 }).setOrigin(0.5);
            this.add.text(config.width / 2, config.height / 2 + 60, `Final Score: ${score}`, { fontSize: '32px', fill: '#00ff00', stroke: '#000000', strokeThickness: 6 }).setOrigin(0.5);

            restartButton.style.display = 'block'; // Show the restart button
        }
    </script>
</body>
</html>
